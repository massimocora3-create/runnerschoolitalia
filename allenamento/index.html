<script>
(async () => {

  const weekBox = document.getElementById("week");

  document.querySelectorAll(".level").forEach(btn => {
    btn.onclick = () => {
      const u = new URL(location.href);
      u.searchParams.set("level", btn.dataset.level);
      location.href = u.toString();
    };
  });

  const level = new URLSearchParams(location.search).get("level");
  if (!level) return;

  document.querySelectorAll(".level").forEach(l => {
    if (l.dataset.level === level) l.classList.add("active");
  });

  const today = new Date().toISOString().slice(0, 10);

  const res = await fetch("/runnerschoolitalia/programma/index.html", {
    cache: "no-store"
  });
  const html = await res.text();

  const temp = document.createElement("div");
  temp.innerHTML = html;

  const levelBlock = temp.querySelector(
    `details.level[data-level="${level}"]`
  );
  if (!levelBlock) {
    weekBox.innerHTML = "<p>Livello non trovato</p>";
    return;
  }

  const week = [...levelBlock.querySelectorAll("details.week")]
    .find(w => today >= w.dataset.start && today <= w.dataset.end);

  if (!week) {
    weekBox.innerHTML = "<p>Nessuna settimana attiva</p>";
    return;
  }

  const clone = week.cloneNode(true);

  /* ðŸ”’ CHIUSA DI DEFAULT */
  clone.removeAttribute("open");

  /* ðŸ§¼ SISTEMA TITOLO */
  const title = clone.querySelector(".week-title");
  const dates = clone.querySelector(".week-dates");
  if (title && dates) {
    title.innerHTML = title.textContent.trim() + " â€“ ";
  }

  weekBox.appendChild(clone);

})();
</script>

